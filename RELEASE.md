# Release Process

This document describes the release process for Plexify, including how to create releases and the structure of build artifacts.

## Overview

Plexify uses GitHub Actions for automated builds and releases. The process is designed to:

1. **Build for multiple platforms** - Linux (amd64, arm64), macOS (amd64, arm64), Windows (amd64, arm64)
2. **Generate checksums** - SHA256 checksums for all binaries
3. **Create GitHub releases** - Automatic release creation with assets
4. **Version management** - Semantic versioning with automatic version detection

## Directory Structure

```
plexify/
├── bin/                    # Local development builds
├── dist/                   # Release builds (generated by CI/CD)
├── .github/workflows/
│   ├── build.yml          # Main build and release workflow
│   └── release.yml        # Auto-release on PR merge
└── ...
```

## Build Artifacts

### Generated Files

When a release is built, the following files are created in the `dist/` directory:

```
dist/
├── plexify-linux-amd64
├── plexify-linux-amd64.sha256
├── plexify-linux-arm64
├── plexify-linux-arm64.sha256
├── plexify-darwin-amd64
├── plexify-darwin-amd64.sha256
├── plexify-darwin-arm64
├── plexify-darwin-arm64.sha256
├── plexify-windows-amd64.exe
├── plexify-windows-amd64.exe.sha256
├── plexify-windows-arm64.exe
├── plexify-windows-arm64.exe.sha256
└── checksums.txt
```

### File Naming Convention

- **Linux**: `plexify-linux-{arch}`
- **macOS**: `plexify-darwin-{arch}`
- **Windows**: `plexify-windows-{arch}.exe`
- **Checksums**: `{binary-name}.sha256`

## Release Process

This repository uses **automatic release creation** when pull requests are merged. This is the only supported release method.

### Auto-release on PR Merge

The repository automatically creates releases when PRs are merged with specific labels:

1. **Label the PR** with one of:
   - `patch` - for bug fixes (increments patch version)
   - `minor` - for new features (increments minor version)
   - `major` - for breaking changes (increments major version)

2. **Merge the PR** - A draft release will be created automatically

### Release Workflow

1. **Development**: Work on features/fixes in branches
2. **Pull Request**: Create a PR with appropriate label (`patch`, `minor`, or `major`)
3. **Review**: Code review and testing
4. **Merge**: When merged, GitHub Actions automatically:
   - Runs tests on all platforms
   - Builds binaries for all supported platforms
   - Creates checksums
   - Creates a draft GitHub release
   - Generates release notes
5. **Publish**: Review the draft release and publish when ready

## Version Management

### Version Detection

The build system automatically detects the version from:

1. **Git tags** (for releases): `v1.0.0`
2. **Git describe** (for development): `v1.0.0-2-gabc1234-dirty`
3. **Fallback**: `dev`

### Version Information

The version is embedded in the binary and can be displayed:

```bash
./plexify -version
# Output: Plexify version v1.0.0
```

## Local Development

### Building Locally

```bash
# Install dependencies
make deps

# Run all checks
make check

# Build for current platform
make build

# Build for all platforms
make build-release

# Run tests
make test

# Clean
make clean
```

## GitHub Actions Workflows

### build.yml

**Triggers:**
- Pull requests to main branch
- Manual workflow dispatch (for testing)

**Jobs:**
1. **test** - Runs tests, vet, and format checks
2. **build** - Builds for all platforms (matrix strategy)

### release.yml

**Triggers:**
- PR merge with specific labels (`patch`, `minor`, `major`)

**Purpose:**
- Automatically creates draft releases based on PR labels
- Supports semantic versioning
- Creates releases only when PRs are merged with appropriate labels

## Best Practices

### 1. PR Labels

Always use appropriate labels for releases:
- `patch` - Bug fixes (increments patch version)
- `minor` - New features (increments minor version)  
- `major` - Breaking changes (increments major version)

### 2. Commit Messages

Use conventional commit messages:
```
feat: add new feature
fix: fix bug
docs: update documentation
```

### 3. Release Process

Follow the established workflow:
1. Create feature/fix branch
2. Create PR with appropriate label
3. Review and test
4. Merge to trigger automatic release
5. Review and publish draft release

### 4. Testing

Always run tests before releasing:
```bash
./scripts/build.sh check
```

### 5. Binary Verification

Users can verify binary integrity:
```bash
# Download binary and checksum (replace v1.0.0 with actual version)
wget https://github.com/garry/plexify/releases/download/v1.0.0/plexify-linux-amd64
wget https://github.com/garry/plexify/releases/download/v1.0.0/plexify-linux-amd64.sha256

# Verify checksum
sha256sum -c plexify-linux-amd64.sha256
```

## Troubleshooting

### Common Issues

1. **Build fails on CI/CD**:
   - Check that all tests pass locally
   - Ensure code is formatted (`go fmt ./...`)
   - Verify no vet issues (`go vet ./...`)

2. **Version not detected**:
   - Ensure you have a valid git tag
   - Check that the tag is pushed to the repository

3. **Release not created**:
   - Verify the tag format is `v*` (e.g., `v1.0.0`)
   - Check GitHub Actions logs for errors
   - Ensure the workflow has proper permissions

### Debugging

For debugging build issues:

```bash
# Enable debug output
./plexify -debug

# Check version
./plexify -version

# Run with verbose output
go test -v ./...
```

## Security

### Binary Security

- All binaries are built with `CGO_ENABLED=0` for static linking
- Binaries are stripped of debug symbols (`-ldflags="-s -w"`)
- SHA256 checksums are provided for verification

### Release Security

- Releases are created as drafts first for review
- All artifacts are signed with checksums
- GitHub's built-in security scanning is enabled

## Support

For issues with the release process:

1. Check the GitHub Actions logs
2. Review this documentation
3. Create an issue in the repository
4. Check the troubleshooting section above 